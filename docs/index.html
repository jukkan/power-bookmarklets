<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Platform Bookmarklets</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            line-height: 1.6;
            color: #333;
        }
        .bookmarklet {
            background: #f6f8fa;
            border: 2px solid #0969da;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        .bookmarklet h3 {
            margin-top: 0;
            color: #0969da;
        }
        .drag-link {
            display: inline-block;
            background: #0969da;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: move;
        }
        .drag-link:hover {
            background: #0550ae;
        }
        .manual-steps {
            background: #fff8c5;
            border-left: 4px solid #fb8500;
            padding: 15px;
            margin: 20px 0;
        }
        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        pre {
            background: #f6f8fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Power Platform Bookmarklets</h1>
    <p>Quick browser tools for Power Platform devs. Drag bookmarklets to your bookmarks bar.</p>

    <div class="manual-steps">
        <strong>‚ö†Ô∏è Can't drag?</strong> Some browsers block dragging. Use the manual install steps below each bookmarklet.
    </div>

    <div class="bookmarklet">
        <h3>üìã Get Table Metadata</h3>
        <p>Extracts Dataverse table schema from a model-driven app view and copies it as a markdown table. Perfect for pasting into Claude, Copilot, or ChatGPT.</p>
        
        <p><strong>‚ú® New:</strong> Now includes choice/picklist values with their IDs and labels!</p>
        
        <p><strong>Install:</strong> Drag this to your bookmarks bar ‚Üí</p>
        <a href="javascript:(function(){const e=new URLSearchParams(window.location.search).get('etn');if(!e)return alert('No entity in URL. Go to a table view first.');const t=window.location.origin,n=`${t}/api/data/v9.2/EntityDefinitions(LogicalName='${e}')`,a=`${n}?$select=LogicalName&$expand=Attributes($select=LogicalName,DisplayName,AttributeType)`,o=`${n}/Attributes/Microsoft.Dynamics.CRM.PicklistAttributeMetadata?$select=LogicalName&$expand=OptionSet($select=Options)`;Promise.all([fetch(a).then(r=>r.json()),fetch(o).then(r=>r.json())]).then(([d,p])=>{const opts={};p.value.forEach(i=>{i.OptionSet?.Options&&(opts[i.LogicalName]=i.OptionSet.Options.map(o=>`${o.Value}: ${o.Label?.LocalizedLabels?.[0]?.Label||o.Value}`).join(', '))});const rows=d.Attributes.filter(a=>!a.LogicalName.match(/^(created|modified|owner|owning|statecode|statuscode|versionnumber|importsequencenumber|overriddencreatedon|timezoneruleversionnumber|utcconversiontimezonecode)/)).map(a=>{const name=a.DisplayName?.LocalizedLabels?.[0]?.Label||'',opt=opts[a.LogicalName]?` [${opts[a.LogicalName]}]`:'';return`| ${a.LogicalName} | ${name} | ${a.AttributeType}${opt} |`}).join('\n'),table=`**Table: ${e}**\n\n| LogicalName | DisplayName | AttributeType |\n|-------------|-------------|---------------|\n${rows}`;navigator.clipboard.writeText(table).then(()=>alert(`‚úì Schema copied!\n\n${d.Attributes.length} total, ${rows.split('\n').length} shown\n${Object.keys(opts).length} choice fields`))}).catch(err=>alert('Error: '+err.message))})();" class="drag-link">Get Table Metadata</a>

        <details style="margin-top: 15px;">
            <summary><strong>Manual install (if drag doesn't work)</strong></summary>
            <ol>
                <li>Right-click your bookmarks bar ‚Üí <code>Add page</code> or <code>Add bookmark</code></li>
                <li>Name: <code>Get Table Metadata</code></li>
                <li>URL: Copy the code below and paste it</li>
            </ol>
            <pre style="font-size: 11px; max-height: 150px; overflow-y: auto;">javascript:(function(){const e=new URLSearchParams(window.location.search).get('etn');if(!e)return alert('No entity in URL. Go to a table view first.');const t=window.location.origin,n=`${t}/api/data/v9.2/EntityDefinitions(LogicalName='${e}')`,a=`${n}?$select=LogicalName&$expand=Attributes($select=LogicalName,DisplayName,AttributeType)`,o=`${n}/Attributes/Microsoft.Dynamics.CRM.PicklistAttributeMetadata?$select=LogicalName&$expand=OptionSet($select=Options)`;Promise.all([fetch(a).then(r=>r.json()),fetch(o).then(r=>r.json())]).then(([d,p])=>{const opts={};p.value.forEach(i=>{i.OptionSet?.Options&&(opts[i.LogicalName]=i.OptionSet.Options.map(o=>`${o.Value}: ${o.Label?.LocalizedLabels?.[0]?.Label||o.Value}`).join(', '))});const rows=d.Attributes.filter(a=>!a.LogicalName.match(/^(created|modified|owner|owning|statecode|statuscode|versionnumber|importsequencenumber|overriddencreatedon|timezoneruleversionnumber|utcconversiontimezonecode)/)).map(a=>{const name=a.DisplayName?.LocalizedLabels?.[0]?.Label||'',opt=opts[a.LogicalName]?` [${opts[a.LogicalName]}]`:'';return`| ${a.LogicalName} | ${name} | ${a.AttributeType}${opt} |`}).join('\n'),table=`**Table: ${e}**\n\n| LogicalName | DisplayName | AttributeType |\n|-------------|-------------|---------------|\n${rows}`;navigator.clipboard.writeText(table).then(()=>alert(`‚úì Schema copied!\n\n${d.Attributes.length} total, ${rows.split('\n').length} shown\n${Object.keys(opts).length} choice fields`))}).catch(err=>alert('Error: '+err.message))})();</pre>
        </details>

        <details style="margin-top: 10px;">
            <summary><strong>Usage</strong></summary>
            <ol>
                <li>Navigate to a table view in a model-driven app</li>
                <li>Click the bookmarklet</li>
                <li>Schema is copied to clipboard</li>
            </ol>
            <p><strong>What gets included:</strong></p>
            <ul>
                <li>All custom fields (filters out system fields like <code>createdon</code>, <code>modifiedby</code>, etc.)</li>
                <li>Choice/picklist values with IDs and labels (e.g., <code>Picklist [1: Draft, 2: Active]</code>)</li>
                <li>Works with any language (uses first available label from environment)</li>
            </ul>
        </details>

        <p style="margin-top: 10px;">
            <a href="https://github.com/jukkan/power-bookmarklets/blob/main/bookmarklets/get-table-metadata.js">üìÑ View source code</a>
        </p>
    </div>

    <hr style="margin: 40px 0;">

    <p><a href="https://github.com/jukkan/power-bookmarklets">‚¨ÖÔ∏è Back to GitHub repo</a></p>
</body>
</html>